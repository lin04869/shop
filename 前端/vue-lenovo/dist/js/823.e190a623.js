"use strict";(self["webpackChunklenovo_shopping"]=self["webpackChunklenovo_shopping"]||[]).push([[823],{2061:function(s,t,e){e.r(t),e.d(t,{default:function(){return l}});e(4114);var a=function(){var s=this,t=s._self._c;return t("div",{staticClass:"main-content"},[t("div",{staticClass:"detail-wrapper"},[t("div",{staticClass:"detail-inner"},[t("el-row",{staticClass:"detail-top-row",attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"goods-img-wrap"},[t("img",{staticClass:"goods-main-img",attrs:{src:s.goodsData.img||"/favicon.ico",alt:"商品图"}})])]),t("el-col",{staticClass:"goods-info-col",attrs:{span:12}},[t("div",{staticClass:"goods-title"},[s._v(s._s(s.goodsData.name))]),t("div",{staticClass:"detail-meta"},[t("div",{staticClass:"meta-row"},[t("span",{staticClass:"label"},[s._v("店铺：")]),t("a",{attrs:{href:"/front/business?id="+s.goodsData.businessId}},[s._v(s._s(s.goodsData.businessName))])]),t("div",{staticClass:"meta-row"},[t("span",{staticClass:"label"},[s._v("产品类别：")]),t("span",{staticClass:"boxed-text"},[s._v(s._s(s.goodsData.category||"联想Lenovo笔记本电脑"))])]),t("div",{staticClass:"meta-row"},[t("span",{staticClass:"label"},[s._v("操作系统：")]),t("span",{staticClass:"boxed-text"},[s._v(s._s(s.goodsOs||"—"))])]),t("div",{staticClass:"meta-row"},[t("span",{staticClass:"label"},[s._v("配 置：")]),t("span",{staticClass:"boxed-text"},[s._v(s._s(s.goodsConfig||"—"))])]),t("div",{staticClass:"meta-row"},[t("span",{staticClass:"label"},[s._v("颜 色：")]),t("span",{staticClass:"boxed-text"},[s._v(s._s(s.goodsColor||"—"))])])]),t("div",{staticClass:"price"},[s._v("价格："),t("span",{staticClass:"price-value"},[s._v(s._s(s.goodsData.price))])]),t("div",{staticClass:"actions"},[t("el-input-number",{staticStyle:{"margin-right":"10px"},attrs:{min:1,max:99},model:{value:s.quantity,callback:function(t){s.quantity=t},expression:"quantity"}}),t("el-button",{staticClass:"btn-buy",attrs:{type:"primary"},on:{click:s.openBuyDialog}},[s._v("立即购买")]),t("el-button",{staticClass:"btn-cart",attrs:{type:"danger"},on:{click:s.addCart}},[s._v("加入购物车")])],1),t("el-dialog",{attrs:{title:"确认购买",visible:s.buyDialogVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){s.buyDialogVisible=t}}},[t("div",{staticStyle:{padding:"8px 10px"}},[t("div",{staticStyle:{"margin-bottom":"10px"}},[s._v("商品："+s._s(s.goodsData.name))]),t("div",{staticStyle:{"margin-bottom":"10px"}},[s._v("单价：￥"+s._s(s.goodsData.price))]),t("div",{staticStyle:{"margin-bottom":"10px"}},[s._v("数量："),t("el-input-number",{attrs:{min:1,max:99},model:{value:s.quantity,callback:function(t){s.quantity=t},expression:"quantity"}})],1),t("div",{staticStyle:{"margin-bottom":"10px"}},[s._v("请选择收货地址： "),t("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:"请选择收货地址"},model:{value:s.addressId,callback:function(t){s.addressId=t},expression:"addressId"}},s._l(s.addressData,(function(s,e){return t("el-option",{key:e,attrs:{label:s.username+" - "+s.useraddress+" - "+s.phone,value:s.id}})})),1),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:s.openQuickAdd}},[s._v("快速新增")]),t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return s.$router.push("/front/address")}}},[s._v("管理地址")])],1),t("div",{staticStyle:{"margin-top":"10px"}},[s._v("合计：￥"+s._s((s.goodsData.price||0)*(s.quantity||1)))])]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){s.buyDialogVisible=!1}}},[s._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:s.confirmBuy}},[s._v("立即下单")])],1)]),t("el-dialog",{attrs:{title:"新增地址",visible:s.addressDialogVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){s.addressDialogVisible=t}}},[t("el-form",{ref:"addressFormRef",staticStyle:{"padding-right":"50px"},attrs:{model:s.addressForm,rules:s.addressRules,"label-width":"100px"}},[t("el-form-item",{attrs:{prop:"username",label:"收货人"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:s.addressForm.username,callback:function(t){s.$set(s.addressForm,"username",t)},expression:"addressForm.username"}})],1),t("el-form-item",{attrs:{prop:"useraddress",label:"收货地址"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:s.addressForm.useraddress,callback:function(t){s.$set(s.addressForm,"useraddress",t)},expression:"addressForm.useraddress"}})],1),t("el-form-item",{attrs:{prop:"phone",label:"联系电话"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:s.addressForm.phone,callback:function(t){s.$set(s.addressForm,"phone",t)},expression:"addressForm.phone"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){s.addressDialogVisible=!1}}},[s._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:s.saveAddress}},[s._v("确 定")])],1)],1)],1)],1),t("el-row",{staticClass:"comment-row",attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-tabs",{on:{"tab-click":s.handleClick},model:{value:s.activeName,callback:function(t){s.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"商品评价",name:"comments"}},[t("div",{staticClass:"comment-list"},[s.commentData&&0!==s.commentData.length?s._e():t("div",{staticClass:"no-comment"},[s._v("暂无评论")]),s._l(s.commentData,(function(e,a){return t("div",{key:e.id||a,staticClass:"comment-item"},[t("div",{staticClass:"comment-head"},[t("img",{staticClass:"comment-avatar",attrs:{src:e.userAvatar||"/favicon.ico"}}),t("div",{staticClass:"comment-meta"},[t("div",{staticClass:"comment-username"},[s._v(s._s(e.userName))]),t("div",{staticClass:"comment-time"},[s._v(s._s(e.time))])])]),t("div",{staticClass:"comment-content"},[s._v(s._s(e.content))])])}))],2)])],1)],1)],1)],1)])])},o=[],i=(e(8111),e(2489),e(7588),e(1701),{name:"Detail",data(){return{goodsData:{},goodsId:"",goodsOs:"",goodsConfig:"",goodsColor:"",commentData:[],activeName:"comments",user:JSON.parse(localStorage.getItem("xm-user")||"{}"),quantity:1,buyDialogVisible:!1,addressId:null,addressData:[],addressDialogVisible:!1,addressForm:{id:null,userId:null,username:"",useraddress:"",phone:""},addressRules:{username:[{required:!0,message:"请输入收货人",trigger:"blur"}],useraddress:[{required:!0,message:"请输入收货地址",trigger:"blur"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"}]}}},created(){this.goodsId=this.$route.query.id||"",this.goodsId&&(this.loadGoodsData(),this.loadComments(),this.loadAddress(),window.addEventListener("storage",this.onStorageEvent))},beforeDestroy(){window.removeEventListener("storage",this.onStorageEvent)},methods:{parseGoodsInfo(s){if(!s)return{os:"",configuration:"",color:""};const t=s.replace(/[、，,；;|]/g,"/").replace(/\s*\/\s*/g,"/").trim(),e=t.split("/").map((s=>s.trim())).filter(Boolean),a=["黑","白","灰","蓝","红","银","金","绿","粉","深","浅","炫彩","渐变"],o=/(windows\s*11|win11|windows\s*10|win10|linux|macos|android|ios|鸿蒙)/i;let i="",r="",d="";return e.forEach((s=>{!d&&a.some((t=>s.includes(t)))?d=s:!i&&o.test(s)?i=s.replace(/^\s*win\s*/i,"Windows ").replace(/win11/i,"Windows 11").replace(/win10/i,"Windows 10").trim():r=r?`${r} / ${s}`:s})),{os:i,configuration:r,color:d}},loadGoodsData(){this.$request.get("/goods/selectById?id="+this.goodsId).then((s=>{if("200"===s.code){this.goodsData=s.data||{};const t=(this.goodsData.description||this.goodsData.name||"").toString(),{os:e,configuration:a,color:o}=this.parseGoodsInfo(t);this.goodsOs=e,this.goodsConfig=a,this.goodsColor=o}else this.$message.error(s.msg||"加载商品失败")})).catch((s=>{this.$message.error("网络错误，无法加载商品"),console.error("加载商品失败：",s)}))},loadComments(){this.goodsId&&this.$request.get("/comment/selectByGoodsId?id="+this.goodsId).then((s=>{if("200"===s.code)try{const t=(s.data||[]).slice();t.sort(((s,t)=>(new Date(t.time).getTime()||0)-(new Date(s.time).getTime()||0))),this.commentData=t}catch(t){this.commentData=s.data||[]}else this.$message.error(s.msg)})).catch((s=>{this.$message.error("加载评论失败，请重试"),console.error("加载评论失败：",s)}))},onStorageEvent(s){"commentUpdate"===s.key&&this.loadComments()},handleClick(s){this.activeName=s.name},openBuyDialog(){if(!this.user||!this.user.id)return this.$message.warning("请先登录"),void this.$router.push("/login");this.buyDialogVisible=!0,this.loadAddress()},confirmBuy(){if(!this.addressId)return void this.$message.warning("请选择收货地址");const s={goodsId:this.goodsId,goodsName:this.goodsData.name,goodsImg:this.goodsData.img,goodsPrice:this.goodsData.price,num:this.quantity,businessId:this.goodsData.businessId},t={userId:this.user.id,addressId:this.addressId,status:"待发货",cartData:[s]};this.$request.post("/orders/add",t).then((s=>{"200"===s.code?(this.$message.success("下单成功"),this.buyDialogVisible=!1,this.$router.push("/front/orders")):this.$message.error(s.msg||"下单失败")})).catch((s=>{console.error("confirmBuy error:",s),this.$message.error("下单失败，请重试")}))},loadAddress(){if(this.user&&this.user.id)return this.$request.get("/address/selectAll",{params:{userId:this.user.id}}).then((s=>("200"===s.code?this.addressData=s.data||[]:this.$message.error(s.msg),s))).catch((s=>{console.error("loadAddress error:",s)}))},openQuickAdd(){this.addressForm={id:null,userId:this.user?.id,username:"",useraddress:"",phone:""},this.addressDialogVisible=!0},saveAddress(){this.$refs.addressFormRef.validate((s=>{if(!s)return;if(!this.user||!this.user.id)return this.$message.error("请先登录"),void this.$router.push("/login");const t=Object.assign({},this.addressForm);t.userId=this.user?.id,this.$request.post("/address/add",t).then((s=>{"200"===s.code?(this.$message.success("保存成功"),s.data&&s.data.id?this.loadAddress().then((()=>{this.addressId=s.data.id,this.addressDialogVisible=!1})):this.loadAddress().then((()=>{this.addressDialogVisible=!1}))):this.$message.error(s.msg)}))}))},addCart(){if(!this.user||!this.user.id)return this.$message.warning("请先登录"),void this.$router.push("/login");this.$request.post("/cart/add",{num:1,userId:this.user.id,goodsId:this.goodsId,businessId:this.goodsData.businessId}).then((s=>{"200"===s.code?(this.$message.success("操作成功"),localStorage.setItem("commentUpdate",Date.now())):this.$message.error(s.msg)})).catch((()=>{this.$message.error("加入购物车失败，请重试")}))}}}),r=i,d=e(1656),n=(0,d.A)(r,a,o,!1,null,"b239804a",null),l=n.exports}}]);
//# sourceMappingURL=823.e190a623.js.map