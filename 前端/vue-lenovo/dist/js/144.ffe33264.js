"use strict";(self["webpackChunklenovo_shopping"]=self["webpackChunklenovo_shopping"]||[]).push([[144],{1763:function(o,t,e){e.r(t),e.d(t,{default:function(){return f}});var r=function(){var o=this,t=o._self._c;return t("div",{staticClass:"page-bg"},[t("el-card",{staticClass:"auth-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"card-head"},[t("div",{staticClass:"logo"},[o._v("Lenovo Shop")]),t("div",{staticClass:"subtitle"},[o._v("账号登录入口")])]),t("el-form",{ref:"formRef",staticClass:"login-form",attrs:{model:o.form,rules:o.rules,"label-position":"top"}},[t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"用户名"},model:{value:o.form.username,callback:function(t){o.$set(o.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",placeholder:"密码","show-password":""},model:{value:o.form.password,callback:function(t){o.$set(o.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",{attrs:{prop:"role"}},[t("el-select",{attrs:{placeholder:"请选择身份"},model:{value:o.form.role,callback:function(t){o.$set(o.form,"role",t)},expression:"form.role"}},[t("el-option",{attrs:{label:"商家管理员",value:"BUSINESS"}}),t("el-option",{attrs:{label:"普通用户",value:"USER"}})],1)],1),t("el-form-item",{staticClass:"action-row"},[t("el-button",{staticClass:"full-btn",attrs:{type:"primary","native-type":"button",loading:o.loading},on:{click:o.onLogin}},[o._v("登 录")])],1),t("div",{staticClass:"small-links"},[t("router-link",{attrs:{to:"/register"}},[o._v("注册账号")]),t("a",{staticStyle:{"margin-left":"12px",cursor:"pointer"},on:{click:function(t){return t.preventDefault(),o.openForgot.apply(null,arguments)}}},[o._v("忘记密码")])],1)],1)],1),t("el-dialog",{attrs:{title:"找回密码",visible:o.showForgot,width:"460px"},on:{"update:visible":function(t){o.showForgot=t}}},["request"===o.forgotStep?t("div",[t("el-form",{ref:"forgotRef",attrs:{model:o.forgotForm,"label-position":"top"}},[t("el-form-item",{attrs:{prop:"account"}},[t("el-input",{attrs:{placeholder:"输入注册邮箱或用户名"},model:{value:o.forgotForm.account,callback:function(t){o.$set(o.forgotForm,"account",t)},expression:"forgotForm.account"}})],1)],1),t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{on:{click:function(t){o.showForgot=!1}}},[o._v("取消")]),t("el-button",{attrs:{type:"primary",loading:o.forgotLoading},on:{click:o.requestReset}},[o._v("发送验证码 / 链接")])],1)],1):t("div",[t("el-form",{ref:"verifyRef",attrs:{model:o.forgotFormVerify,"label-position":"top"}},[t("el-form-item",{attrs:{prop:"token"}},[t("el-input",{attrs:{placeholder:"输入邮箱收到的验证码或 token"},model:{value:o.forgotFormVerify.token,callback:function(t){o.$set(o.forgotFormVerify,"token",t)},expression:"forgotFormVerify.token"}})],1),t("el-form-item",{attrs:{prop:"newPassword"}},[t("el-input",{attrs:{placeholder:"新密码","show-password":""},model:{value:o.forgotFormVerify.newPassword,callback:function(t){o.$set(o.forgotFormVerify,"newPassword",t)},expression:"forgotFormVerify.newPassword"}})],1),t("el-form-item",{attrs:{prop:"confirm"}},[t("el-input",{attrs:{placeholder:"确认新密码","show-password":""},model:{value:o.forgotFormVerify.confirm,callback:function(t){o.$set(o.forgotFormVerify,"confirm",t)},expression:"forgotFormVerify.confirm"}})],1)],1),t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{on:{click:function(t){o.forgotStep="request"}}},[o._v("返回")]),t("el-button",{attrs:{type:"primary",loading:o.forgotLoading},on:{click:o.submitReset}},[o._v("重置密码")])],1)],1)])],1)},s=[],i=(e(4114),{name:"Login",data(){return{loading:!1,form:{username:"",password:"",role:""},rules:{username:[{required:!0,message:"请填写用户名",trigger:"blur"}],password:[{required:!0,message:"请填写密码",trigger:"blur"}],role:[{required:!0,message:"请选择用户身份",trigger:"change"}]},showForgot:!1,forgotStep:"request",forgotLoading:!1,forgotForm:{account:""},forgotFormVerify:{token:"",newPassword:"",confirm:""}}},methods:{onLogin(){this.$refs.formRef.validate((o=>{o&&(this.loading=!0,this.$request.post("/login",this.form).then((o=>{if(this.loading=!1,"200"===o.code){const t=o.data;localStorage.setItem("xm-user",JSON.stringify(t)),this.$message.success("登录成功"),"USER"===t.role?this.$router.push("/front/home"):this.$router.push("/home")}else this.$message.error(o.msg||"登录失败")})).catch((()=>{this.loading=!1})))}))},openForgot(){this.showForgot=!0,this.forgotStep="request",this.forgotForm.account="",this.forgotFormVerify={token:"",newPassword:"",confirm:""}},requestReset(){this.forgotForm.account?(this.forgotLoading=!0,this.$request.post("/api/auth/forgot/request",{account:this.forgotForm.account}).then((o=>{this.forgotLoading=!1,"200"===o.code?(this.$message.success("已发送，请查看邮箱（或使用收到的验证码）"),this.forgotStep="verify"):this.$message.error(o.msg||"发送失败")})).catch((()=>{this.forgotLoading=!1}))):this.$message.warning("请填写邮箱或用户名")},submitReset(){const o=this.forgotFormVerify;o.token&&o.newPassword?o.newPassword===o.confirm?(this.forgotLoading=!0,this.$request.post("/api/auth/forgot/reset",{token:o.token,newPassword:o.newPassword}).then((o=>{this.forgotLoading=!1,"200"===o.code?(this.$message.success("重置成功，请使用新密码登录"),this.showForgot=!1,this.forgotStep="request",this.forgotForm={account:""},this.forgotFormVerify={token:"",newPassword:"",confirm:""}):this.$message.error(o.msg||"重置失败")})).catch((()=>{this.forgotLoading=!1}))):this.$message.warning("两次密码不一致"):this.$message.warning("请填写完整信息")}}}),a=i,n=e(1656),l=(0,n.A)(a,r,s,!1,null,"08e596ec",null),f=l.exports}}]);
//# sourceMappingURL=144.ffe33264.js.map