"use strict";(self["webpackChunklenovo_shopping"]=self["webpackChunklenovo_shopping"]||[]).push([[879],{879:function(e,s,t){t.r(s),t.d(s,{default:function(){return n}});var a=function(){var e=this,s=e._self._c;return s("div",{staticClass:"main-content"},[s("div",{staticStyle:{width:"70%","background-color":"white",margin:"30px auto","border-radius":"20px"}},[s("div",{staticStyle:{"padding-bottom":"10px"}},[s("div",{staticStyle:{display:"flex","font-size":"18px",color:"#000000FF","line-height":"80px","border-bottom":"#cccccc 1px solid"}},[s("div",{staticStyle:{"margin-left":"20px",flex:"1"}},[e._v("全部商品（"+e._s(e.goodsData.length)+"件）")]),s("div",{staticStyle:{flex:"2","text-align":"right",display:"flex","align-items":"center",gap:"8px","justify-content":"flex-end"}},[s("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:"请选择收货地址"},model:{value:e.addressId,callback:function(s){e.addressId=s},expression:"addressId"}},e._l(e.addressData,(function(e,t){return s("el-option",{key:t,attrs:{label:e.username+" - "+e.useraddress+" - "+e.phone,value:e.id}})})),1),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.openQuickAdd}},[e._v("快速新增")]),s("el-button",{attrs:{type:"warning",size:"mini"},on:{click:e.openAddress}},[e._v("管理地址")])],1),s("div",{staticStyle:{flex:"1","font-size":"16px","text-align":"right","padding-right":"20px"}},[e._v(" 已选商品 ￥ "+e._s(e.totalPrice)+" "),s("el-button",{attrs:{type:"danger",round:""},on:{click:e.pay}},[e._v("下单")])],1)]),s("div",{staticStyle:{margin:"20px 0",padding:"0 50px"}},[s("div",{staticClass:"table"},[s("el-table",{attrs:{data:e.goodsData,strip:""},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),s("el-table-column",{attrs:{label:"商品图片",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.goodsImg?s("el-image",{staticStyle:{width:"80px",height:"60px","border-radius":"3px"},attrs:{src:t.row.goodsImg,"preview-src-list":[t.row.goodsImg]}}):e._e()]}}])}),s("el-table-column",{attrs:{prop:"goodsName",label:"商品名称",width:"240px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("a",{attrs:{href:"/front/detail?id="+t.row.goodsId}},[e._v(e._s(t.row.goodsName))])]}}])}),s("el-table-column",{attrs:{prop:"businessName",label:"店铺名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("a",{attrs:{href:"/front/business?id="+t.row.businessId}},[e._v(e._s(t.row.businessName))])]}}])}),s("el-table-column",{attrs:{prop:"goodsPrice",label:"商品价格"}}),s("el-table-column",{attrs:{prop:"num",label:"选择数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-input-number",{staticStyle:{width:"100px"},attrs:{min:1},on:{change:function(s){return e.handleChange(t.row)}},model:{value:t.row.num,callback:function(s){e.$set(t.row,"num",s)},expression:"scope.row.num"}})]}}])}),s("el-table-column",{attrs:{label:"操作",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(s){return e.del(t.row.id)}}},[e._v("移除购物车")])]}}])})],1),s("div",{staticClass:"pagination",staticStyle:{"margin-top":"20px"}},[s("el-pagination",{attrs:{background:"","current-page":e.pageNum,"page-sizes":[5,10,20],"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)])])]),s("el-dialog",{attrs:{title:"新增地址",visible:e.addressDialogVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(s){e.addressDialogVisible=s}}},[s("el-form",{ref:"addressFormRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.addressForm,rules:e.addressRules,"label-width":"100px"}},[s("el-form-item",{attrs:{prop:"username",label:"收货人"}},[s("el-input",{attrs:{autocomplete:"off"},model:{value:e.addressForm.username,callback:function(s){e.$set(e.addressForm,"username",s)},expression:"addressForm.username"}})],1),s("el-form-item",{attrs:{prop:"useraddress",label:"收货地址"}},[s("el-input",{attrs:{autocomplete:"off"},model:{value:e.addressForm.useraddress,callback:function(s){e.$set(e.addressForm,"useraddress",s)},expression:"addressForm.useraddress"}})],1),s("el-form-item",{attrs:{prop:"phone",label:"联系电话"}},[s("el-input",{attrs:{autocomplete:"off"},model:{value:e.addressForm.phone,callback:function(s){e.$set(e.addressForm,"phone",s)},expression:"addressForm.phone"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(s){e.addressDialogVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.saveAddress}},[e._v("确 定")])],1)],1)],1)},r=[],d=(t(4114),t(8111),t(116),t(7588),{data(){return{user:JSON.parse(localStorage.getItem("xm-user")||"{}"),goodsData:[],pageNum:1,pageSize:10,totalPrice:0,total:0,addressId:null,addressData:[],selectedData:[],addressDialogVisible:!1,addressForm:{id:null,userId:null,username:"",useraddress:"",phone:""},addressRules:{username:[{required:!0,message:"请输入收货人",trigger:"blur"}],useraddress:[{required:!0,message:"请输入收货地址",trigger:"blur"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"}]}}},mounted(){this.loadGoods(1),this.loadAddress()},methods:{loadAddress(){return this.$request.get("/address/selectAll",{params:{userId:this.user?.id}}).then((e=>("200"===e.code?this.addressData=e.data||[]:this.$message.error(e.msg),e)))},openAddress(){this.$router.push("/front/address")},openQuickAdd(){this.addressForm={id:null,userId:this.user?.id||null,username:"",useraddress:"",phone:""},this.addressDialogVisible=!0},saveAddress(){this.$refs.addressFormRef.validate((e=>{if(!e)return;if(!this.user||!this.user.id)return this.$message.error("请先登录"),void this.$router.push("/login");const s=Object.assign({},this.addressForm);s.userId=this.user?.id,this.$request.post("/address/add",s).then((e=>{"200"===e.code?(this.$message({message:"保存成功",type:"success",duration:1200}),e.data&&e.data.id?this.loadAddress().then((()=>{this.addressId=e.data.id,this.addressDialogVisible=!1})):this.loadAddress().then((()=>{const e=this.addressData.find((e=>e.useraddress===s.useraddress&&e.phone===s.phone));e&&(this.addressId=e.id),this.addressDialogVisible=!1}))):this.$message.error(e.msg)})).catch((e=>{console.error("saveAddress error:",e),this.$message.error("保存失败，请检查网络或稍后重试")}))}))},loadGoods(e){e&&(this.pageNum=e),this.$request.get("/cart/selectPage",{params:{pageNum:this.pageNum,pageSize:this.pageSize}}).then((e=>{"200"===e.code?(this.goodsData=e.data?.list,this.total=e.data?.total):this.$message.error(e.msg)}))},navTo(e){location.href=e},del(e){this.$request.delete("/cart/delete/"+e).then((e=>{"200"===e.code?(this.$message({message:"移除成功",type:"success",duration:1e3}),this.loadGoods(1)):this.$message.error(e.msg)}))},handleCurrentChange(e){this.loadGoods(e)},handleSelectionChange(e){this.totalPrice=0,this.selectedData=e,this.selectedData.forEach((e=>{this.totalPrice+=e.goodsPrice*e.num}))},handleChange(e){this.totalPrice=0,this.selectedData.forEach((e=>{this.totalPrice+=e.goodsPrice*e.num}))},pay(){if(!this.addressId)return void this.$message.warning("请选择收货地址");if(!this.selectedData||0===this.selectedData.length)return void this.$message.warning("请选择商品");let e={userId:this.user.id,addressId:this.addressId,status:"待发货",cartData:this.selectedData};this.$request.post("/orders/add",e).then((e=>{"200"===e.code?(this.$message.success("操作成功"),this.loadGoods(1)):this.$message.error(e.msg)}))}}}),o=d,i=t(1656),l=(0,i.A)(o,a,r,!1,null,null,null),n=l.exports}}]);
//# sourceMappingURL=879.7034b213.js.map