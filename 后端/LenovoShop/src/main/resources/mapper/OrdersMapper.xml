<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ouc.lenovoshop.mapper.OrdersMapper">

    <sql id="Base_Column_List">
        id,order_no,goods_id,business_id,num,user_id,address_id,total_price,status
    </sql>

    <select id="selectAll" resultType="com.ouc.lenovoshop.entity.Orders">
        select
            orders.id as id,
            orders.user_id as userId,
            orders.business_id as businessId,
            orders.goods_id as goodsId,
            orders.num as num,
            orders.total_price as price,
            orders.address_id as addressId,
            CASE orders.status
                WHEN 0 THEN '待付款'
                WHEN 1 THEN '待发货'
                WHEN 2 THEN '待收货'
                WHEN 3 THEN '已完成'
                ELSE '' END as status,
            orders.order_no as orderId,
            business.name as businessName,
            goods.img as goodsImg,
            goods.name as goodsName,
            goods.price as goodsPrice,
            user.username as username,
            address.detail as useraddress,
            address.phone as phone
        from orders
        left join business on orders.business_id = business.id
        left join goods on orders.goods_id = goods.id
        left join address on orders.address_id = address.id
        left join user on orders.user_id = user.id
        <where>
            <if test="id != null"> and id= #{id}</if>
            <if test="userId != null"> and orders.user_id = #{userId}</if>
            <if test="businessId != null"> and orders.business_id = #{businessId}</if>
            <if test="goodsId != null"> and goods_id = #{goodsId}</if>
            <if test="num != null"> and num = #{num}</if>
            <if test="price != null"> and total_price = #{price}</if>
            <if test="addressId != null"> and address_id = #{addressId}</if>
            <if test="status != null"> and status = #{status}</if>
            <if test="orderId != null"> and order_no = #{orderId}</if>
        </where>
    </select>

    <select id="selectById" resultType="com.ouc.lenovoshop.entity.Orders">
        select
            id,
            user_id as userId,
            business_id as businessId,
            goods_id as goodsId,
            num,
            total_price as price,
            address_id as addressId,
            CASE status
                WHEN 0 THEN '待付款'
                WHEN 1 THEN '待发货'
                WHEN 2 THEN '待收货'
                WHEN 3 THEN '已完成'
                ELSE '' END as status,
            user.username as username,
            order_no as orderId
        from orders
        left join user on orders.user_id = user.id
        where id = #{id}
    </select>

    <delete id="deleteById">
        delete from orders
        where  id = #{id}
    </delete>

    <insert id="insert" parameterType="com.ouc.lenovoshop.entity.Orders" useGeneratedKeys="true">
        insert into orders
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="orderId != null">order_no,</if>
            <if test="goodsId != null">goods_id,</if>
            <if test="businessId != null">business_id,</if>
            <if test="num != null">num,</if>
            <if test="userId != null">user_id,</if>
            <if test="addressId != null">address_id,</if>
            <if test="price != null">total_price,</if>
            <if test="status != null">status,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="orderId != null">#{orderId},</if>
            <if test="goodsId != null">#{goodsId},</if>
            <if test="businessId != null">#{businessId},</if>
            <if test="num != null">#{num},</if>
            <if test="userId != null">#{userId},</if>
            <if test="addressId != null">#{addressId},</if>
            <if test="price != null">#{price},</if>
            <if test="status != null">#{status},</if>
        </trim>
    </insert>

    <update id="updateById" parameterType="com.ouc.lenovoshop.entity.Orders">
        update orders
        <set>
            <if test="userId != null">
                user_id = #{userId},
            </if>
            <if test="businessId != null">
                business_id = #{businessId},
            </if>
            <if test="goodsId != null">
                goods_id = #{goodsId},
            </if>
            <if test="num != null">
                num = #{num},
            </if>
            <if test="price != null">
                total_price = #{price},
            </if>
            <if test="addressId != null">
                address_id = #{addressId},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
            <if test="orderId != null">
                order_no = #{orderId},
            </if>
        </set>
        where id = #{id}
    </update>

</mapper>